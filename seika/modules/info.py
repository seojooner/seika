import platform
import socket
from datetime import datetime

import psutil
from pyrogram import Client, types

from .. import __version__, loader, utils


def byter(num: float, suffix: str = "B") -> str:
    for unit in ["B", "K", "M", "G", "T", "P", "E", "Z"]:
        if abs(num) < 1024.0:
            return "%3.1f%s%s" % (num, unit, suffix)
        num /= 1024.0

    return "%.1f%s%s" % (num, "Yi", suffix)

@loader.module(name="UserBot")
class AboutMod(loader.Module):
    """–£–∑–Ω–∞–π—Ç–µ —á—Ç–æ —Ç–∞–∫–æ–µ —é–∑–µ—Ä–±–æ—Ç, –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–µ–º üàÇÔ∏èseika"""
    
    async def info_cmd(self, app: Client, message: types.Message):
        """–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–µ–º üàÇÔ∏èseika."""
        await utils.answer(message, "‚òï")
        me: types.User = await app.get_me()
        psutil_winerr = False

        try:
            boot = psutil.boot_time()
            bt = datetime.fromtimestamp(boot)
        except:
            psutil_winerr = True

        await utils.answer(
            message,
            f"""
`üàÇÔ∏è seika | UserBot`

`üíª UserBot`
<b>–í–ª–∞–¥–µ–ª–µ—Ü</b>: `{me.username}`
<b>–í–µ—Ä—Å–∏—è</b>: `v{__version__}`
""" + (f"""
`üß† –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä`
<b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</b>: `{int(psutil.cpu_percent())}%`
<b>–Ø–¥–µ—Ä</b>: `{psutil.cpu_count()}`

`üóÉ –û–ó–£`
<b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</b>: `{byter(psutil.virtual_memory().used)}`/`{byter(psutil.virtual_memory().total)}`

`üíæ –ü–ó–£`
[/] | <b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</b>: `{byter(psutil.disk_usage("/").used)}`/`{byter(psutil.disk_usage("/").total)}` (`{psutil.disk_usage("/").percent}%`)

`üñ•Ô∏è –•–æ—Å—Ç`
<b>–°–∏—Å—Ç–µ–º–∞</b>: `{platform.uname().system}`
<b>–£–∑–µ–ª</b>: `{platform.uname().node}`
<b>–†–µ–ª–∏–∑</b>: `{platform.uname().release}`
<b>–í–µ—Ä—Å–∏—è</b>: `{platform.uname().version}`
<b>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</b>: `{platform.machine()}`
<b>–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä</b>: `{platform.processor()}`
<b>–ò–º—è —Ö–æ—Å—Ç–∞</b>: `{socket.gethostname()}`
<b>–†–∞–±–æ—Ç–∞–µ—Ç —Å</b>: `{bt.year}/{bt.month}/{bt.day} {bt.hour}:{bt.minute}:{bt.second}`""" if not psutil_winerr else ""))
        
    async def ubinfo_cmd(self, app: Client, message: types.Message, args: str):
        """–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ UserBot"""
        await utils.answer(message, "‚òï")
        await utils.answer(message, '''ü§î <b>–ß—Ç–æ —Ç–∞–∫–æ–µ —é–∑–µ—Ä–±–æ—Ç?</b>
        
üìö <b>–Æ–∑–µ—Ä–±–æ—Ç —ç—Ç–æ</b> - <b>–°–±–æ—Ä–Ω–∏–∫ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º</b> –¥–ª—è –≤–∑–∞–π–º–æ–¥e–π—Å—Ç–≤–∏—è —Å Telegarm API
–ê —Å –ø–æ–º–æ—â—å—é –≤–∑–∞–π–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegarm API <b>–º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ä–∞–∑–Ω—ãe —Å–∫—Ä–∏–ø—Ç—ã</b> –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–∞–∫–∏–µ –∫–∞–∫: <b>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–∞–Ω–∞–ª–∞–º, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –∏ —Ç.–¥</b>

ü§î <b>–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —é–∑–µ—Ä–±–æ—Ç –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –±–æ—Ç–∞?</b>

ü§≠ <b>–Æ–∑–µ—Ä–±–æ—Ç –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b>
–ù–∞–ø—Ä–∏–º–µ—Ä: @pavel_durov –ê –±–æ—Ç –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –±–æ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞—Ö –Ω–∞–ø—Ä–∏–º–µ—Ä: @examplebot
<b>–Æ–∑–µ—Ä–±–æ—Ç—ã –¥–æ–≤–æ–ª—å–Ω–æ –≥–∏–±–∫–∏–µ</b> –≤ –ø–ª–∞–Ω–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —É –Ω–∏—Ö –±–æ–ª—å—à–µ —Ñ—É–Ω–∫—Ü–∏–π.

üõë <b>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ª–∏ –æ—Ñ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —é–∑–µ—Ä–±–æ—Ç—ã —Ç–µ–ª–µ–≥—Ä–∞–º–æ–º?</b>

üö´ <b>–ù–µ—Ç.</b> –û–Ω–∏ –æ—Ñ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è, –Ω–æ –≤–∞—Å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —é–∑–µ—Ä–±–æ—Ç–æ–≤.
–ù–æ <b>–º–æ–≥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–ª—É—á–∞–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –∫–æ–¥–∞ –∏–ª–∏ –∑–∞ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ Telegarm API</b> –Ω–∞ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ, —Ç–∞–∫ —á—Ç–æ –≤–ª–∞–¥–µ–ª—å—Ü—É —é–∑–µ—Ä–±–æ—Ç–∞ –Ω–∞–¥–æ —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ.''')
